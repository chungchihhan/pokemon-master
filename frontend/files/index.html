<!DOCTYPE html>
<html>
  <head>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
    />
    <link rel="stylesheet" href="styles.css" />
    <title>AWS Pokemon</title>
    <script>
      // const INVOKE_URL = "INVOKE_URL_PLACEHOLDER";
      const INVOKE_URL = "https://nmrvguqda2.execute-api.ap-northeast-1.amazonaws.com";
      function searchPokemon() {
        var pokemonName = document.getElementById("pokemonName").value;
        var requestData = {
          queryStringParameters: {
            pokemon_name: pokemonName,
          },
        };

        var requestOptions = {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(requestData),
        };
        document.getElementById("loading").style.display = "block";
        fetch(INVOKE_URL + "/pokemon/" + pokemonName, requestOptions)
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json(); // Parse JSON
          })
          .then((data) => {
            displayPokemon(data);
            document.getElementById("loading").style.display = "none";
          })
          .catch((error) => {
            document.getElementById("response").textContent = "Error: " + error;
            document.getElementById("loading").style.display = "none";
          });
      }
      function displayPokemon(pokemonData) {
        const isShiny = pokemonData.sprites.selected_sprite.includes("shiny");
        var card = `
          <div id="searchPokemon-response" class=${isShiny ? "searchPokemon-area-shiny" : "searchPokemon-area"}>
            <p class="searchPokemon-title">${pokemonData.name}</p>
            <div class="searchPokemon-info">
              <img
              class="pokemon-image"
              src="${pokemonData.sprites.selected_sprite}"
              alt="pokemon-image"
              />
              <div class="searchPokemon-info-text">
                <div class="abilities">
                  <strong>Abilities:</strong>
                  <div class="keywords">${pokemonData.abilities.map((a) => a.name).join(", ")}</div>
                </div>
                <div class="types">
                  <strong>Types:</strong>
                  <div class="keywords">${pokemonData.types.map((t) => t.name).join(", ")}</div>
                </div>
                <div class="height">
                  <strong>Height:</strong>
                  <div class="keywords">${pokemonData.height}</div>
                </div>
                <div class="weight">
                  <strong>Weight:</strong>
                  <div class="keywords">${pokemonData.weight}</div>
                </div>
              </div>
            </div>
          </div>
        `;
        document.getElementById("searchPokemon-response").outerHTML = card;
      }


      function listPokemons() {
        var requestOptions = {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        };
        document.getElementById("loading-bag").style.display = "block";
        fetch(INVOKE_URL + "/pokemons", requestOptions)
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json(); // Parse JSON
          })
          .then((data) => {
            displayAllPokemon(data);
            document.getElementById("loading-bag").style.display = "none";
          })
          .catch((error) => {
            document.getElementById("response").textContent = "Error: " + error;
            document.getElementById("loading-bag").style.display = "none";
          });
      }
      function displayAllPokemon(pokemonList) {
        var cards = pokemonList
          .map((pokemonData) => {
            const isShiny =
              pokemonData.sprites.selected_sprite.includes("shiny");
            const cardClass = isShiny
              ? "pokemon-card-bag-shiny"
              : "pokemon-card-bag";

            return `
            <div class="${cardClass}">
                <div class="pokemon-name-bag">${pokemonData.name}</div>
                <img class="pokemon-image-bag" src="${
                  pokemonData.sprites.selected_sprite
                }" alt="${pokemonData.name}">
                <div class="pokemon-info-bag"><strong>Abilities:</strong> ${pokemonData.abilities
                  .map((a) => a.name)
                  .join(", ")}</div>
                <div class="pokemon-info-bag"><strong>Types:</strong> ${pokemonData.types
                  .map((t) => t.name)
                  .join(", ")}</div>
                <div class="pokemon-info-bag"><strong>Height:</strong> ${
                  pokemonData.height
                }</div>
                <div class="pokemon-info-bag"><strong>Weight:</strong> ${
                  pokemonData.weight
                }</div>
            </div>
            `;
          })
          .join("");
        document.getElementById("allPokemonResponse").innerHTML = cards;
      }
    </script>
  </head>
  <body class="whole-background">
    <h1 class="pokemon-master-title">~ AWS Pokemon Master ~</h1>
    <div class="main-container">
      <div class="interaction-area">
        <input
          type="text"
          id="pokemonName"
          placeholder="Enter the Pokemon name"
        />
        <button onclick="searchPokemon()">
          Catch!
          <img src="pokeball.png" alt="pokeball" class="pokeball-icon" />
        </button>
        <button onclick="listPokemons()">
          Bag!
          <img src="bag.png" alt="bag" class="bag-icon" />
        </button>
      </div>
      <div id="searchPokemon-response"></div>
      <!-- <div class="list_pokemon-area">
        <div class="list_pokemon-area-title">
          <img
            src="red_backpack.png"
            alt="red_backpack"
            onclick="listPokemons()"
            class="red-backpack-icon"
          />
        </div>
        <div
          id="loading-bag"
          style="display: none"
          class="pokeball-icon-loading"
        >
          <img src="pokeball.png" alt="pokeball" />
          Checking your bag...
        </div>
      -->
        <!-- <div id="allPokemonResponse" class="cards-area"></div> -->
      </div> 
      <div id="loading" style="display: none" class="pokeball-icon-loading">
        <img src="pokeball.png" alt="pokeball" />
        Catching...
      </div>
      <!-- <div id="searchPokemon_response"></div>-->
  
    </div>
  </body>
</html>
